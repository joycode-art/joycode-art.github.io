<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <title>可测试性设计</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">
  <meta name="author" content="JoyCode Inc.">
  <meta name="generator" content="Hugo 0.80.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://joycode-art.github.io/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="https://joycode-art.github.io/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="https://joycode-art.github.io/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="https://joycode-art.github.io/plugins/slick/slick-theme.css">
  
  <link rel="stylesheet" href="https://joycode-art.github.io/plugins/aos/aos.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://joycode-art.github.io/scss/style.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://joycode-art.github.io/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="https://joycode-art.github.io/images/favicon.png" type="image/x-icon">

  
  <meta property="og:image" content="https://joycode-art.github.io/images/blogs/012.png" />
  
  <meta property="og:title" content="可测试性设计" />
<meta property="og:description" content="this is meta description" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joycode-art.github.io/blog/01-test-design/" />
<meta property="article:published_time" content="2020-03-14T15:40:24+06:00" />
<meta property="article:modified_time" content="2020-03-14T15:40:24+06:00" />

  

</head><body id="top" data-spy="scroll" data-target="#navbar-spy" class="position-relative">
<!-- preloader start -->
<div class="preloader position-fixed d-flex align-items-center justify-content-center">
  <div class="block">
    <div class="loader-image mb-20">
      <img src="images/preloader.png" alt="">
    </div>
    <h2 class="loader-text text-uppercase">
      <span class="h3 font-weight-light mb-1">Welcome to</span>
      <span class="font-weight-bold">JoyCode</span>
    </h2>
  </div> 
</div>
<!-- preloader end -->
<header class="header-nav position-relative">
    <div class="container">
      <nav class="navbar navbar-expand-xl navbar-light px-0">
        <a class="navbar-brand p-0" href="https://joycode-art.github.io">
          
          <img class="img-fluid" src="https://joycode-art.github.io/images/logo.png" alt="JoyCode: A Hardcore Software Consultancy | JoyCode">
          
        </a>

        <button class="navbar-toggler bg-white rounded-0 p-0" type="button" data-toggle="collapse"
          data-target="#navlinks" aria-controls="navlinks" aria-expanded="false" aria-label="Toggle navigation">
          <svg class="nav-toggle-icon" viewBox="0 0 100 100" width="40" onclick="this.classList.toggle('active')">
            <path class="line top"
              d="m 70,33 h -40 c 0,0 -8.5,-0.149796 -8.5,8.5 0,8.649796 8.5,8.5 8.5,8.5 h 20 v -20" />
            <path class="line middle" d="m 70,50 h -40" />
            <path class="line bottom"
              d="m 30,67 h 40 c 0,0 8.5,0.149796 8.5,-8.5 0,-8.649796 -8.5,-8.5 -8.5,-8.5 h -20 v 20" /></svg>
        </button>
        

        <div class="collapse navbar-collapse" id="navlinks">
          <ul class="navbar-nav mx-auto">
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/">主页</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/solution">解决方案</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/story">咨询案例</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/training">企业培训</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/conference">大会分享</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/blog">技术洞见</a>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="https://joycode-art.github.io/team">关于我们</a>
            </li>
            
            
            
          </ul>
        </div>
        
      </nav>
    </div>
  </header>

  
  <section class="section-padding pt-50">
    <div class="container">
      <div class="row justify-content-center">
        
        <div class="col-lg-9 col-md-12 mb-60" data-aos="fade-in" data-aos-delay="50">
          <div class="post-category position-relative mb-15"><a
            href="/categories/%e5%bc%80%e5%8f%91%e8%80%85%e6%b5%8b%e8%af%95" class="text-black-200 font-weight-600 ml-1">开发者测试 </a>
            
          </div>

          <h2 class="font-weight-bold mb-30">可测试性设计</h2>

          <div class="post-meta font-weight-600 text-primary mb-15">
            <a target="_blank" class="text-primary" href="https://joycode.art/team/02-liuguangcong/">刘光聪</a>
            <span class="mx-2">|</span>
            <span>14 Mar, 2020</span>
            <span class="mx-2">|</span>
            <span>1 Mins Read</span>
          </div>
          <div class="content"><h2 id="架构是完美的实现是骨干的">架构是完美的，实现是骨干的</h2>
<p>在切入这个主题之前，先看一个“完美架构图”的问题。我相信你肯定看过无数多个类似这样的架构图，每个框框都排布整齐，而且显得特别高大上。</p>
<p><img src="https://www.joycode.art/images/blogs/01-test-design/01.webp" alt="引自：架构就是画框框？熊节"></p>
<p>但是，实际的系统实现真的是这样吗？未必。系统往往充满了各种变化、约束、限制和条件，这些隐式的概念往往是不能“公诸于世”的。设计存在就是为了控制住系统实现的复杂度，应对软件的变化，并将这些隐式的概念显式化。</p>
<p>但是，我们也不能否认架构存在的意义，至少它利于个体之间的交流，利于与客户的沟通，并在更高维度的角度看待问题，并指导进一步的系统设计和实现。</p>
<h2 id="分层架构">分层架构</h2>
<p>理论上，任何复杂的系统都可以用一个main函数实现，但事实上没人那么干，分层架构便是一种最朴素的系统分解和组合的架构思维，并符合大部分人的心智模型。</p>
<p><img src="https://www.joycode.art/images/blogs/01-test-design/02.webp" alt="分层架构"></p>
<p>分层架构最大的好处在于提供了层间抽象和隔离的机制，并非常容易在工程上保证层间的契约不被破坏。例如，分层架构遵守单向依赖原则，当有人违背架构原则而引入循环依赖，采用一些架构看护的工具，使能自动检查这些行为的。</p>
<p>其次，分层架构有利于开展模块间并行开发和协作。每个模块只要边界清晰，便可以独立开发了。但是，任何的软件工程方法的实践，必然存在它的边际效应。</p>
<h2 id="同层模块间依赖混乱模块内实现一团乱麻">同层模块间依赖混乱、模块内实现一团乱麻，</h2>
<p>这是很多系统实现的真实写照。虽然，层间调用和约定都得到了很好的约束和保证，但同层内的模块间的耦合程度极高，相互引用和依赖，缺失架构原则的约束和检查。</p>
<p>更有甚者，模块内实现基本都是基于全局变量的过程化设计，缺失最基本的封装。在面临变化的时候，要么就是堆砌if-else，要么大面积拷贝代码，修修补补，导致系统实现的耦合度急剧攀升，最终将系统成功演进为典型的“腐化系统”。</p>
<p><img src="https://www.joycode.art/images/blogs/01-test-design/03.webp" alt="系统实现的现状"></p>
<h2 id="设计边界">设计边界</h2>
<p>当我们确定了设计的边界和范围，便自然地决定了软件工程效率提升的边界、独立测试的边界、独立构建的边界，及其独立可替换的设计边界。</p>
<p><img src="https://www.joycode.art/images/blogs/01-test-design/04.webp" alt="设计边界"></p>
<h3 id="边际效应">边际效应</h3>
<p>任何流程、工具和机器提升效率的边界，约束在设计边界的最大效应内，无法跨代提升。唯有改进设计，将设计的边界往内迁移，相应的工程效率才能得到质的提升和飞越。</p>
<h3 id="边界等同">边界等同</h3>
<p>设计边界即独立裁剪的边界，独立测试和独立交付的构建边界。如果层间之间的依赖是抽象的，那么层测试所依赖的其他层实现便可以替换为测试替身；如果层内模块之间是低耦合的，那么模块测试所依赖的其他模块也可以替换为测试替身；如果模块内类或函数之间是低耦合的，那么类或函数所依赖的其他类或函数也可以替换为测试替身。</p>
<h3 id="设计优先">设计优先</h3>
<p>因此，可替换性(裁剪性)、可测试性是提前设计出来的，是由设计的边界决定的，这便是&quot;Design for Testability&quot;的原始初衷。</p>
<h2 id="测试金字塔">测试金字塔</h2>
<p>因为设计的边界决定了测试的边界。正如上述的系统实现，如果将系统看成整体，其外部的依赖和可观察的行为是可以控制的，所以设计相应的系统测试，虽然复杂，而且极难构造，但它是一种较为可行的测试方案。所以，这也是遗留系统普遍采用的一种测试方案，产生了大量的ST用例。</p>
<p>层间接口也较为稳定，所以也可以构造出大量的IT用例；而层内模块之间耦合程度逐渐增大，所以CT用例越来越少；随着设计边界的边际效应的消失，模块内的单元测试构造成本很高，或测试用例很脆弱，大部分系统实践单元测试最终走向了不归路。</p>
<p>最终，实际的测试金字塔是倒立的，或呈现菱形。与理想的测试金字塔刚好相反或背道而驰。</p>
<p><img src="https://www.joycode.art/images/blogs/01-test-design/05.webp" alt="测试金字塔"></p>
<p>理论上，UT是容易构造的，而且反馈是急快的，而且应该拥有绝对数量的UT用例。但是，现实并非如此，构造的UT并非易事；实现可能依赖庞大的全局变量，函数入参的结构体包含了繁杂的字段，而且函数实现朝夕令改，导致用例极为脆弱。</p>
<p>就其本质，这都是设计的问题。如果将每个全局变量进行合理的封装，那么内部逻辑变得更加稳定，测试用例的前置条件也变得容易构造；如果将不必要的依赖剥离，将实现最小化依赖，测试用例也会变得更加健壮；如果将依赖设计为抽象的，那么在测试中便可以轻松地替换为测试替身，提升可测试性。</p>
<p>总而言之，可测试性是设计出来的(Design for Testability)。</p>
</div>
        </div>
          
        
      </div>
    </div>
  </section>
  

  
  <section class="pb-50">
    <div class="container">
      <div class="row justify-content-center" data-aos="fade-up">
        <div class="col-lg-6 col-md-9 text-center mb-40">
          <h2 class="section-title">Recent Articles</h2>
        </div>
      </div>
      <div class="row">
        
        <div class="col-lg-4 col-md-6 mb-40">
          <div class="card border-0 h-100">
            <a class="d-flex flex-fill align-items-center" href="https://joycode-art.github.io/blog/01-test-design/"><img class="card-img-top rounded" src="https://joycode-art.github.io/images/blogs/012.png" alt="blog-image"></a>
            <div class="p-25 pb-0">
              <div class="post-category position-relative mb-15"><a
                href="/categories/%e5%bc%80%e5%8f%91%e8%80%85%e6%b5%8b%e8%af%95" class="text-black-200 font-weight-600 ml-1">开发者测试 </a>
                
              </div>
              <a class="h4 font-weight-bold d-block mb-15" href="https://joycode-art.github.io/blog/01-test-design/">可测试性设计</a>
              <div class="post-meta font-weight-600 mb-15">14 Mar, 2020<span class="mx-2">|</span>1 Mins Read
              </div>
              <p>架构是完美的，实现是骨干的 在切入这个主题之前，先看一个“完美架构图”的问题。我相信你肯定看过无数多个类似这样的架构图，每个框框都排布整齐，而且显得特别高大上。
但是，实际的系统实现真的是这样吗？未必。系统往往充满了各种变化、约束、限制和条件，这些隐式的概念往往是不能“公诸于世”的。设计存在就是为了控制住系统实现的复杂度，应对软件的变化，并将这些隐式的概念显式化。
但是，我们也不能否认架构存在的意义，至少它利于个体之间的交流，利于与客户的沟通，并在更高维度的角度看待问题，并指导进一步的系统设计和实现。
分层架构 理论上，任何复杂的系统都可以用一个main函数实现，但事实上没人那么干，分层架构便是一种最朴素的系统分解和组合的架构思维，并符合大部分人的心智模型。
分层架构最大的好处在于提供了层间抽象和隔离的机制，并非常容易在工程上保证层间的契约不被破坏。例如，分层架构遵守单向依赖原则，当有人违背架构原则而引入循环依赖，采用一些架构看护的工具，使能自动检查这些行为的。
其次，分层架构有利于开展模块间并行开发和协作。每个模块只要边界清晰，便可以独立开发了。但是，任何的软件工程方法的实践，必然存在它的边际效应。
同层模块间依赖混乱、模块内实现一团乱麻， 这是很多系统实现的真实写照。虽然，层间调用和约定都得到了很好的约束和保证，但同层内的模块间的耦合程度极高，相互引用和依赖，缺失架构原则的约束和检查。</p>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-40">
          <div class="card border-0 h-100">
            <a class="d-flex flex-fill align-items-center" href="https://joycode-art.github.io/blog/02-impl-design/"><img class="card-img-top rounded" src="https://joycode-art.github.io/images/blogs/007.png" alt="blog-image"></a>
            <div class="p-25 pb-0">
              <div class="post-category position-relative mb-15"><a
                href="/categories/%e8%bd%af%e4%bb%b6%e8%ae%be%e8%ae%a1" class="text-black-200 font-weight-600 ml-1">软件设计 </a>
                
              </div>
              <a class="h4 font-weight-bold d-block mb-15" href="https://joycode-art.github.io/blog/02-impl-design/">实现正交设计</a>
              <div class="post-meta font-weight-600 mb-15">14 Mar, 2020<span class="mx-2">|</span>5 Mins Read
              </div>
              <p>软件设计的目标 软件设计就是为了完成如下目标，其可验证性、重要程度依次减低。
 实现功能 易于重用 易于理解 没有冗余  实现功能 实现功能的目标压倒一起，这也是软件设计的首要标准。如何判定系统功能的完备性呢？通过所有测试用例。</p>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-40">
          <div class="card border-0 h-100">
            <a class="d-flex flex-fill align-items-center" href="https://joycode-art.github.io/blog/04-performance/"><img class="card-img-top rounded" src="https://joycode-art.github.io/images/blogs/005.png" alt="blog-image"></a>
            <div class="p-25 pb-0">
              <div class="post-category position-relative mb-15"><a
                href="/categories/%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e5%b7%a5%e7%a8%8b" class="text-black-200 font-weight-600 ml-1">系统性能工程 </a>
                
              </div>
              <a class="h4 font-weight-bold d-block mb-15" href="https://joycode-art.github.io/blog/04-performance/">系统性能优化</a>
              <div class="post-meta font-weight-600 mb-15">14 Mar, 2020<span class="mx-2">|</span>0 Mins Read
              </div>
              <p></p>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </section>
  



<footer class="bg-light-gray has-shapes has-bg-brash bg-brash-top" style="padding-top: 0pt">

  <div class="footer-bottom">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="block border-top text-center content">Copyright @ <a href="https://joycode.art/">卓酷软件技术（西安）有限责任公司</a> All Rights Reserved     备案号：陕ICP备2020017028号</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>



<a href="#top" class="btn btn-primary scroll-to-top-btn smooth-scroll position-fixed"><svg
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
    <path id="Layer" fill="currentColor"
      d="M7.2 19.2L15.2 11.2C15.68 10.71 16.43 10.68 16.96 11.08L17.08 11.2L25.08 19.2L23.2 21.08L16.14 14.02L9.08 21.08L7.2 19.2Z" />
    </svg></a>


<!-- JS Plugins -->

<script src="https://joycode-art.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://joycode-art.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://joycode-art.github.io/plugins/slick/slick.min.js"></script>

<script src="https://joycode-art.github.io/plugins/shuffle/shuffle.min.js"></script>

<script src="https://joycode-art.github.io/plugins/aos/aos.js"></script>


<!-- Main Script -->

<script src="https://joycode-art.github.io/js/script.min.js"></script></body>

</html>